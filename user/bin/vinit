#!/bin/bash -e

VIRTUALENV_OPTS=""
while [ -n "$*" ]
do
	case $1 in
		-p|--pypy)
		VIRTUALENV_OPTS="${VIRTUALENV_OPTS} --python=$(which pypy)"
		;;
		-2)
		VIRTUALENV_OPTS="${VIRTUALENV_OPTS} --python=$(which python2)"
		;;
		-3)
		VIRTUALENV_OPTS="${VIRTUALENV_OPTS} --python=$(which python3)"
		;;
	esac
	shift
done

# use virtualenv2 on ArchLinux to enforce Python 2.x
VIRTUALENV=$(which virtualenv2 2>/dev/null) || true
if [ ! "${VIRTUALENV}" ]; then
	VIRTUALENV=$(which virtualenv)
fi


function log
{
	GREEN="\E[32m"
	RESET="\033[00;00m"
	echo -e "${GREEN}$1${RESET}"
}


log "Create virtualenv"
${VIRTUALENV} ${VIRTUALENV_OPTS} --distribute --no-site-packages venv

log "Activate virtualenv"
source venv/bin/activate

# update base packages
log "Update virtualenv"
pip install --upgrade pip
pip install --upgrade flup wsgiref distribute

# install some more packages
log "Install yolk and South"
pip install yolk
pip install South

# show some suggestions for copy&paste on demand
log "Install candidates"
echo pip install pylibmc
echo pip install django-memcache-status
echo pip install django-extensions
echo pip install psycopg2
echo pip install mysql-python

echo
echo "Activate: source venv/bin/activate"

log "Done."
